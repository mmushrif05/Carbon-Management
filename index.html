<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CarbonTrack Pro | Construction Sustainability Platform</title>
<link rel="stylesheet" href="css/styles.css">
</head>
<body>

<!-- DB STATUS INDICATOR -->
<div class="db-status offline" id="dbStatus">
  <span class="db-dot"></span>
  <span id="dbStatusText">Connecting...</span>
</div>

<!-- LOADING -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner"></div>
  <div class="loading-text">Connecting to database...</div>
</div>

<!-- LOGIN -->
<div id="loginScreen" style="display:none">
  <div class="login-card">
    <div class="login-logo">ğŸŒ</div>
    <div class="login-title">Carbon<span>Track</span> Pro</div>
    <div class="login-sub">Construction Embodied Carbon & Sustainability Platform</div>

    <!-- SIGN IN FORM -->
    <div id="loginForm">
      <div class="login-input">
        <div class="login-label">Email</div>
        <input id="loginEmail" type="email" placeholder="Enter your email" autocomplete="email" />
      </div>

      <div class="login-input">
        <div class="login-label">Password</div>
        <input id="loginPassword" type="password" placeholder="Enter your password" autocomplete="current-password" />
      </div>

      <div class="login-error" id="loginError"></div>

      <button class="login-btn" id="loginBtn" onclick="handleLogin()">Sign In</button>

      <div class="login-toggle"><a onclick="showForgotPassword()" style="font-size:12px">Forgot password?</a></div>
      <div class="login-toggle"><span style="color:var(--slate5);font-size:11px">ğŸ”’ Registration is by invitation only</span></div>
      <div class="login-toggle" style="margin-top:4px"><a onclick="showSetup()" style="font-size:11px;color:var(--slate5);opacity:0.6">First-time setup?</a></div>
    </div>

    <!-- FORGOT PASSWORD FORM -->
    <div id="forgotForm" style="display:none">
      <div class="invite-banner" style="margin-bottom:16px;background:rgba(96,165,250,0.08);border-color:rgba(96,165,250,0.2)">
        <div class="invite-banner-icon">ğŸ”‘</div>
        <div class="invite-banner-text" style="font-size:12px">
          <strong style="color:var(--blue)">Reset Password</strong><br>
          <span style="color:var(--slate5)">Enter your email and we'll send you a link to reset your password.</span>
        </div>
      </div>

      <div class="login-input">
        <div class="login-label">Email Address</div>
        <input id="forgotEmail" type="email" placeholder="Enter your registered email" autocomplete="email" />
      </div>

      <div class="login-error" id="forgotError"></div>

      <button class="login-btn" id="forgotBtn" onclick="handleForgotPassword()">Send Reset Link</button>

      <div class="login-toggle"><a onclick="showLogin()">Back to Sign In</a></div>
    </div>

    <!-- REGISTER FORM -->
    <div id="registerForm" style="display:none">
      <!-- Invitation info banner (shown when registering via invite link) -->
      <div id="inviteInfo" style="display:none;margin-bottom:16px"></div>

      <div class="login-input">
        <div class="login-label">Full Name</div>
        <input id="regName" placeholder="Enter your full name" autocomplete="name" />
      </div>

      <div class="login-input">
        <div class="login-label">Email</div>
        <input id="regEmail" type="email" placeholder="Enter your email" autocomplete="email" />
      </div>

      <div class="login-input">
        <div class="login-label">Password</div>
        <input id="regPassword" type="password" placeholder="Min 12 chars, upper + lower + digit + special" autocomplete="new-password" />
      </div>

      <div class="invite-notice">
        <div class="invite-notice-icon">ğŸ”’</div>
        <div class="invite-notice-text">Registration is by invitation only. You need an invitation link from a client or consultant to create an account.</div>
      </div>

      <div class="login-error" id="regError"></div>

      <button class="login-btn" id="regBtn" onclick="handleRegister()">Create Account</button>

      <div class="login-toggle">Already have an account? <a onclick="showLogin()">Sign in</a></div>
    </div>

    <!-- FIRST-TIME SETUP FORM (Bootstrap) -->
    <div id="setupForm" style="display:none">
      <div class="invite-banner" style="margin-bottom:16px;background:rgba(251,191,36,0.08);border-color:rgba(251,191,36,0.2)">
        <div class="invite-banner-icon">âš¡</div>
        <div class="invite-banner-text" style="font-size:12px">
          <strong style="color:#fbbf24">First-Time Setup</strong><br>
          <span style="color:var(--slate5)">Create the first Client admin account. This can only be done once.</span>
        </div>
      </div>

      <div class="login-input">
        <div class="login-label">Your Name</div>
        <input id="setupName" placeholder="Enter your full name" autocomplete="name" />
      </div>

      <div class="login-input">
        <div class="login-label">Email</div>
        <input id="setupEmail" type="email" placeholder="Enter your email" autocomplete="email" />
      </div>

      <div class="login-input">
        <div class="login-label">Password</div>
        <input id="setupPassword" type="password" placeholder="Min 12 chars, upper + lower + digit + special" autocomplete="new-password" />
      </div>

      <div class="login-input">
        <div class="login-label">Setup Key</div>
        <input id="setupKey" type="password" placeholder="Enter the BOOTSTRAP_KEY from Netlify" />
      </div>

      <div class="login-error" id="setupError"></div>

      <button class="login-btn" id="setupBtn" onclick="handleBootstrap()">Create Admin Account</button>

      <div class="login-toggle"><a onclick="showLogin()">Back to Sign In</a></div>
    </div>

    <div class="login-footer">v2.1 â€¢ Construction Embodied Carbon Platform</div>
  </div>
</div>

<!-- APP -->
<div id="appShell" style="display:none">
  <button class="menu-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')">â˜°</button>
  <div class="app-layout">
    <nav class="sidebar" id="sidebar">
      <div class="sb-header"><div class="sb-logo"><span class="sb-logo-icon">ğŸŒ</span><span class="sb-logo-text">Carbon<span>Track</span></span></div><div class="sb-version">Pro v2.0 â€¢ Cloud DB</div></div>
      <div class="sb-nav" id="sidebarNav"></div>
      <div class="sb-footer"><div class="sb-user"><div class="sb-avatar" id="userAvatar">C</div><div><div class="sb-uname" id="userName">User</div><div class="sb-urole" id="userRole">Role</div></div></div><div class="sb-logout" onclick="logout()">â† Sign Out</div></div>
    </nav>
    <div class="main-content">
      <div class="page-header"><div class="page-title" id="pageTitle">Dashboard</div><div class="page-desc" id="pageDesc"></div></div>
      <div class="page-body" id="pageBody"></div>
    </div>
  </div>
</div>

<!-- ===== APPLICATION SCRIPTS ===== -->
<!-- No Firebase SDK on client â€” all credentials are on the server -->
<!-- SheetJS for Excel/XLSX parsing (Tender BOQ Upload) â€” crossorigin for CORS security -->
<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js" crossorigin="anonymous"></script>
<!-- PDF.js for PDF Tender Document Parsing â€” crossorigin for CORS security -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js" crossorigin="anonymous"></script>
<script>if(typeof pdfjsLib!=='undefined')pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';</script>
<!-- Security: Session timeout & idle detection -->
<script src="js/security.js"></script>
<script src="js/data.js"></script>
<script src="js/config.js"></script>
<script src="js/db.js"></script>
<script src="js/state.js"></script>
<script src="js/auth.js"></script>
<script src="js/pages.js"></script>
<script src="js/tender.js"></script>
<script src="js/intelligence.js"></script>
<script src="js/iot.js"></script>
<script src="js/app.js"></script>
</body>
</html>
